[gd_scene load_steps=33 format=2]

[ext_resource path="res://Scripts/Main.gd" type="Script" id=1]
[ext_resource path="res://icon.png" type="Texture" id=2]
[ext_resource path="res://Scripts/CellularAutomata.gd" type="Script" id=3]
[ext_resource path="res://CellularAutomataThread.tscn" type="PackedScene" id=4]
[ext_resource path="res://TilesetLALA.tres" type="TileSet" id=5]
[ext_resource path="res://Scripts/Growth_Manager.gd" type="Script" id=6]
[ext_resource path="res://Scripts/Player.gd" type="Script" id=7]
[ext_resource path="res://Textures/Characters/aiming_arrow.png" type="Texture" id=8]
[ext_resource path="res://Textures/Characters/character0.png" type="Texture" id=9]
[ext_resource path="res://Interface/GasMeter.tscn" type="PackedScene" id=10]
[ext_resource path="res://Textures/Interface/sapling.png" type="Texture" id=11]
[ext_resource path="res://Interface/MainDynamicFont.tres" type="DynamicFont" id=12]
[ext_resource path="res://Textures/gun_spritesheet.png" type="Texture" id=13]
[ext_resource path="res://Scripts/DrawWater.gd" type="Script" id=14]
[ext_resource path="res://Interface/SmallDynamicFont.tres" type="DynamicFont" id=15]
[ext_resource path="res://Interface/LargeDynamicFont.tres" type="DynamicFont" id=16]
[ext_resource path="res://Textures/rain_particle.png" type="Texture" id=17]
[ext_resource path="res://MainEnvironment.tres" type="Environment" id=18]

[sub_resource type="Shader" id=1]
code = "shader_type canvas_item;

uniform sampler2D grid_tex;
uniform vec2 screen_size = vec2(1024.0, 768.0);

void fragment() {
	// convert UV coordinates to screen
	// this is in PIXELS
	vec2 uv_to_screen = vec2( UV.x * screen_size.y * (32.0/24.0), UV.y * screen_size.y);
	
	// now convert these back to tilemap coordinates
	// this is in INDICES
	vec2 screen_to_map = vec2( floor(uv_to_screen.x / 32.0), floor(uv_to_screen.y / 32.0) );
	
	// and convert this back to a UV => divide by total pixel size of texture
	// (add 0.5 to be in the center of the pixel we want; if we don't do this, we pick the value at the edge, which will lead to unpredictable resutls)
	vec2 pixel_size = 1.0 / vec2(textureSize(grid_tex, 0));
	vec2 map_to_uv = vec2( (screen_to_map.x + 0.5) * pixel_size.x, (screen_to_map.y + 0.5) * pixel_size.y);
	
	// set color based on cellular automaton texture
	COLOR = texture(grid_tex, map_to_uv).rgba;
}"

[sub_resource type="ShaderMaterial" id=2]
shader = SubResource( 1 )
shader_param/screen_size = Vector2( 1024, 768 )
shader_param/grid_tex = ExtResource( 2 )

[sub_resource type="PhysicsMaterial" id=3]
friction = 0.0

[sub_resource type="CapsuleShape2D" id=4]
height = 10.0

[sub_resource type="RectangleShape2D" id=5]
extents = Vector2( 7.5, 5 )

[sub_resource type="Curve" id=6]
min_value = -3.0
max_value = 3.0
_data = [ Vector2( 0, 0.176 ), 0.0, 0.0, 0, 0, Vector2( 0.355715, 1.32 ), 0.0, 0.0, 0, 0, Vector2( 0.721706, -1.2144 ), 0.0, 0.0, 0, 0, Vector2( 1, 0 ), 0.0, 0.0, 0, 0 ]

[sub_resource type="CurveTexture" id=7]
curve = SubResource( 6 )

[sub_resource type="ParticlesMaterial" id=8]
flag_disable_z = true
spread = 20.0
gravity = Vector3( 0, 0, 0 )
initial_velocity = 5.0
initial_velocity_random = 0.2
orbit_velocity = 0.0
orbit_velocity_random = 0.0
tangential_accel = -1.0
tangential_accel_random = 0.5
tangential_accel_curve = SubResource( 7 )
scale = 2.0
scale_random = 0.2

[sub_resource type="CircleShape2D" id=9]
radius = 80.0

[sub_resource type="Shader" id=11]
code = "shader_type canvas_item;

uniform sampler2D noise_tex;

void vertex() {
	if( int(VERTEX.y) % 32 != 0) {
		VERTEX.y += sin(TIME + VERTEX.x) * 2.0 - 2.0;
	}
}

void fragment() {
	COLOR.a = texture(noise_tex, SCREEN_UV).r * 0.25 + 0.5;
}"

[sub_resource type="OpenSimplexNoise" id=13]

[sub_resource type="NoiseTexture" id=14]
seamless = true
noise = SubResource( 13 )

[sub_resource type="ShaderMaterial" id=12]
shader = SubResource( 11 )
shader_param/noise_tex = SubResource( 14 )

[sub_resource type="ParticlesMaterial" id=10]
emission_shape = 2
emission_box_extents = Vector3( 200, 512, 1 )
flag_disable_z = true
spread = 0.0
gravity = Vector3( 0, 0, 0 )
initial_velocity = 700.0
initial_velocity_random = 0.4
angular_velocity = -1.32416e-024
orbit_velocity = 0.0
orbit_velocity_random = 0.0
scale_random = 0.1

[node name="Node2D" type="Node2D"]
script = ExtResource( 1 )

[node name="CellularAutomata" type="CanvasLayer" parent="."]
editor/display_folded = true
layer = -5

[node name="Control" type="Control" parent="CellularAutomata"]
anchor_right = 1.0
anchor_bottom = 1.0

[node name="ColorRect" type="ColorRect" parent="CellularAutomata/Control"]
material = SubResource( 2 )
anchor_right = 1.0
anchor_bottom = 1.0
script = ExtResource( 3 )

[node name="Semaphore" parent="CellularAutomata/Control/ColorRect" instance=ExtResource( 4 )]

[node name="TreesLayer" type="CanvasLayer" parent="."]
layer = -2

[node name="TileMap" type="TileMap" parent="."]
position = Vector2( 0, -1 )
z_index = 5
tile_set = ExtResource( 5 )
cell_size = Vector2( 32, 32 )
collision_layer = 3
collision_mask = 3
format = 1
tile_data = PoolIntArray( 65545, 0, 0, 65546, 0, 0, 65547, 0, 0, 65548, 0, 0, 65549, 0, 0, 131079, 0, 0, 131085, 0, 0, 131086, 0, 0, 196614, 0, 0, 196615, 0, 0, 196622, 0, 0, 196623, 0, 0, 262148, 0, 0, 262149, 0, 0, 262150, 0, 0, 262159, 0, 0, 262160, 0, 0, 262161, 0, 0, 327697, 0, 0, 327698, 0, 0, 327706, 0, 0, 327707, 0, 0, 327708, 0, 0, 327709, 0, 0, 327710, 0, 0, 393235, 0, 0, 393242, 0, 0, 524288, 0, 0, 524289, 0, 0, 524290, 0, 0, 524291, 0, 0, 524292, 0, 0, 524293, 0, 0, 524294, 0, 0, 524295, 0, 0, 524296, 0, 0, 524297, 0, 0, 524298, 0, 0, 524299, 0, 0, 524300, 0, 0, 524301, 0, 0, 524302, 0, 0, 524303, 0, 0, 524310, 0, 0, 524311, 0, 0, 524312, 0, 0, 524313, 0, 0, 524314, 0, 0, 524315, 0, 0, 524316, 0, 0, 524317, 0, 0, 524318, 0, 0, 524319, 0, 0, 589832, 0, 0, 589833, 0, 0, 589834, 0, 0, 589840, 0, 0, 589841, 0, 0, 589846, 0, 0, 589847, 0, 0, 589848, 0, 0, 655367, 0, 0, 655377, 0, 0, 655382, 0, 0, 720902, 0, 0, 720903, 0, 0, 720913, 0, 0, 720914, 0, 0, 720918, 0, 0, 786454, 0, 0, 851968, 0, 0, 851969, 0, 0, 851970, 0, 0, 851990, 0, 0, 917506, 0, 0, 917507, 0, 0, 917508, 0, 0, 917509, 0, 0, 917525, 0, 0, 917526, 0, 0, 983059, 0, 0, 983060, 0, 0, 983061, 0, 0, 1048594, 0, 0, 1114112, 0, 0, 1179649, 0, 0, 1179650, 0, 0, 1179651, 0, 0, 1179652, 0, 0, 1179661, 0, 0, 1179662, 0, 0, 1179663, 0, 0, 1245188, 0, 0, 1245189, 0, 0, 1245190, 0, 0, 1245191, 0, 0, 1245192, 0, 0, 1245193, 0, 0, 1245194, 0, 0, 1245195, 0, 0, 1245196, 0, 0, 1245203, 0, 0, 1310740, 0, 0, 1310741, 0, 0, 1376278, 0, 0, 1376279, 0, 0, 1441816, 0, 0, 1441817, 0, 0, 1441818, 0, 0, 1441819, 0, 0, 1441820, 0, 0, 1441821, 0, 0, 1441822, 0, 0, 1441823, 0, 0 )

[node name="Growth_Manager" type="Node2D" parent="."]
script = ExtResource( 6 )

[node name="Player" type="RigidBody2D" parent="." groups=[
"Players",
"OxygenTakers",
"WarmthGivers",
]]
editor/display_folded = true
position = Vector2( 416.503, 229.593 )
mode = 2
physics_material_override = SubResource( 3 )
gravity_scale = 10.0
script = ExtResource( 7 )

[node name="AimingArrow" type="Sprite" parent="Player"]
modulate = Color( 1.5, 2, 2, 1 )
texture = ExtResource( 8 )
offset = Vector2( 24, 0 )

[node name="Sprite" type="Sprite" parent="Player"]
scale = Vector2( 0.5, 0.5 )
texture = ExtResource( 9 )

[node name="CollisionShape2D" type="CollisionShape2D" parent="Player"]
shape = SubResource( 4 )

[node name="Area2D" type="Area2D" parent="Player"]
editor/display_folded = true
position = Vector2( 0, 20 )
collision_layer = 2
collision_mask = 2

[node name="CollisionShape2D" type="CollisionShape2D" parent="Player/Area2D"]
shape = SubResource( 5 )

[node name="Interface" type="Node2D" parent="Player"]
editor/display_folded = true
position = Vector2( -417.003, -227.81 )

[node name="HP" parent="Player/Interface" instance=ExtResource( 10 )]
position = Vector2( 205.805, 47.6099 )
scale = Vector2( 0.4, 0.4 )

[node name="OxygenLevels" parent="Player/Interface" instance=ExtResource( 10 )]
position = Vector2( 193.15, 84.2754 )
scale = Vector2( 0.2, 0.2 )

[node name="HeatLevels" parent="Player/Interface" instance=ExtResource( 10 )]
position = Vector2( 179.554, 108.286 )
scale = Vector2( 0.2, 0.2 )

[node name="ThirstLevels" parent="Player/Interface" instance=ExtResource( 10 )]
position = Vector2( 161.567, 132.307 )
scale = Vector2( 0.2, 0.2 )

[node name="SaplingSprite" type="Sprite" parent="Player/Interface"]
position = Vector2( 79.3767, 78.7705 )
scale = Vector2( 0.45, 0.45 )
texture = ExtResource( 11 )

[node name="SaplingCounter" type="Label" parent="Player/Interface"]
margin_left = 29.7326
margin_top = 34.6465
margin_right = 129.733
margin_bottom = 223.647
rect_min_size = Vector2( 100, 0 )
custom_fonts/font = ExtResource( 12 )
text = "-5
"
align = 1

[node name="BellParticles" type="Particles2D" parent="Player"]
position = Vector2( 0, -5 )
rotation = -1.57079
emitting = false
lifetime = 8.0
local_coords = false
process_material = SubResource( 8 )

[node name="AttractArea" type="Area2D" parent="Player"]

[node name="CollisionShape2D" type="CollisionShape2D" parent="Player/AttractArea"]
shape = SubResource( 9 )

[node name="WeaponIcon" type="Sprite" parent="Player"]
visible = false
position = Vector2( 0, -30 )
scale = Vector2( 0.4, 0.4 )
texture = ExtResource( 13 )
hframes = 5

[node name="AudioPlayer" type="AudioStreamPlayer2D" parent="Player"]
volume_db = -12.0

[node name="Weather_Manager" type="Node2D" parent="."]
position = Vector2( 0, -1 )

[node name="WeatherLayer" type="CanvasLayer" parent="."]
editor/display_folded = true

[node name="DrawWater" type="Node2D" parent="WeatherLayer"]
material = SubResource( 12 )
script = ExtResource( 14 )

[node name="Interface" type="CanvasLayer" parent="."]
layer = 3

[node name="Control" type="Control" parent="Interface"]
anchor_right = 1.0
anchor_bottom = 1.0

[node name="Timer" type="Label" parent="Interface/Control"]
anchor_left = 0.5
anchor_top = 1.0
anchor_right = 0.5
anchor_bottom = 1.0
margin_left = -37.0
margin_top = -47.0
margin_right = 37.0
custom_fonts/font = ExtResource( 15 )
text = "3:00"
align = 2

[node name="PauseScreen" type="CanvasLayer" parent="."]
pause_mode = 2
layer = 10

[node name="Control" type="Control" parent="PauseScreen"]
visible = false
anchor_right = 1.0
anchor_bottom = 1.0

[node name="MarginContainer" type="MarginContainer" parent="PauseScreen/Control"]
anchor_right = 1.0
anchor_bottom = 1.0
custom_constants/margin_right = 100
custom_constants/margin_top = 100
custom_constants/margin_left = 100
custom_constants/margin_bottom = 100

[node name="ColorRect" type="ColorRect" parent="PauseScreen/Control/MarginContainer"]
margin_left = 100.0
margin_top = 100.0
margin_right = 924.0
margin_bottom = 668.0
color = Color( 0, 0, 0, 0.588235 )

[node name="CenterContainer" type="CenterContainer" parent="PauseScreen/Control/MarginContainer"]
margin_left = 100.0
margin_top = 100.0
margin_right = 924.0
margin_bottom = 668.0

[node name="VBoxContainer" type="VBoxContainer" parent="PauseScreen/Control/MarginContainer/CenterContainer"]
margin_left = 120.0
margin_top = 102.0
margin_right = 703.0
margin_bottom = 465.0
custom_constants/separation = 20

[node name="GameOver" type="Label" parent="PauseScreen/Control/MarginContainer/CenterContainer/VBoxContainer"]
margin_right = 583.0
margin_bottom = 133.0
custom_fonts/font = ExtResource( 16 )
text = "GAME OVER"

[node name="Result" type="Label" parent="PauseScreen/Control/MarginContainer/CenterContainer/VBoxContainer"]
margin_top = 153.0
margin_right = 583.0
margin_bottom = 246.0
custom_fonts/font = ExtResource( 12 )
custom_colors/font_color = Color( 0.431373, 1, 0, 1 )
text = "You won!"
align = 1

[node name="Instructions" type="Label" parent="PauseScreen/Control/MarginContainer/CenterContainer/VBoxContainer"]
margin_top = 266.0
margin_right = 583.0
margin_bottom = 363.0
custom_fonts/font = ExtResource( 15 )
custom_colors/font_color = Color( 0.701961, 0.701961, 0.701961, 1 )
text = "Press ENTER to restart
Press ESC to return to menu"
align = 1

[node name="Rain_Particles" type="Particles2D" parent="."]
position = Vector2( 564.402, 80.2193 )
rotation = 1.83259
emitting = false
amount = 75
lifetime = 1.3
process_material = SubResource( 10 )
texture = ExtResource( 17 )

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = ExtResource( 18 )

[node name="AudioStreamPlayer0" type="AudioStreamPlayer" parent="."]

[node name="AudioStreamPlayer1" type="AudioStreamPlayer" parent="."]
volume_db = -4.0
[connection signal="body_entered" from="Player/AttractArea" to="Player" method="_on_AttractArea_body_entered"]
[connection signal="body_exited" from="Player/AttractArea" to="Player" method="_on_AttractArea_body_exited"]
[connection signal="finished" from="AudioStreamPlayer0" to="." method="_on_AudioStreamPlayer0_finished"]
